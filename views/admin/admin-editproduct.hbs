
{{#if productDetails}}
<center>
  <section class="col-sm-12 col-lg-12 col-md-12 ml-5 mt-5">


    <form style="width: 70%;" method="POST" action="/admin/edit-product/{{productDetails._id}}" enctype="multipart/form-data">

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="">Product Name</label>
          <input type="text" class="form-control" id="productname" name="productname" placeholder=""
            value="{{productDetails.productname}}">
        </div>
      </div>

      <div class="form-row mt-3">
        <div class="form-group col-md-6">
          <label for="">Product Code</label>
          <input type="text" class="form-control" id="productcode" name="productcode" placeholder="">
        </div>
      </div>

      <div class="mb-3 form-row mt-3">
      
        <select name="productcategory" id="mainCategory" class="btn btn-primary text-light custom-select">
          <option value="" class="dropdown-item text-dark bg-" disabled>Product Category </option>
          {{#each allCategories}}
          <option value="{{this.mainCategory}}" class="dropdown-item">{{this.mainCategory}}</option>
          {{/each}}
        </select>
      </div>

      

       
        <div class="mb-3 form-row mt-3">
          <select name="productsubcategory" id="" class="btn btn-primary text-light custom-select">
            <option value="" class="dropdown-item text-dark bg-" disabled>Product sub Category </option>
            {{#each allCategories}}
            {{#each this.SubCategory}}
            <option value="{{this}}" class="dropdown-item">{{this}}</option>
            {{/each}}
            {{/each}}
        
          </select>
        </div>


          <div class="mb-3 form-row mt-3">
            <select name="productbrand" id="" class="btn btn-primary text-light custom-select">
              <option value="" class="dropdown-item text-dark bg-" disabled>Product Brand </option>
              {{#each allProductBrands}}
          
              <option value="{{this.ProBrand}}" class="dropdown-item">{{this.ProBrand}}</option>
          
              {{/each}}
          
            </select>
          </div>

        <div class="mb-3 form-row mt-3">
          <select name="suitablebikebrand" id="bikebrand" class="btn btn-primary text-light custom-select">
            <option value="" name="" class="dropdown-item text-dark bg-light">Suitable bike Brand </option>
            {{#each allBikeBrands}}
        
            <option value="{{this.bikeBrand}}" class="dropdown-item">{{this.bikeBrand}}</option>
        
            {{/each}}
        
          </select>
        </div>

        <div class="mb-3 form-row mt-3">
          <select name="suitablebikemodel" id="bikebrand1" class="btn btn-primary text-light custom-select">
            <option value="" name="" class="dropdown-item text-dark bg-light">Suitable bike Model </option>
            {{#each allBikeBrands}}
            {{#each this.models}}
            <option value="{{this}}" class="dropdown-item">{{this}}</option>
            {{/each}}
            {{/each}}
        
          </select>
        </div>


      <div class="form-row mt-2">
        <div class="form-group col-md-6">
          <label for="">Price</label>
          <input type="text" class="form-control" name="productprice" id="productprice" placeholder=""
            value="{{{productDetails.productprice}}}">
        </div>
      </div>
      <div class="form-row mt-2">
        <div class="form-group col-md-6">
          <label for="">Offer Price</label>
          <input type="text" class="form-control" name="productofferprice" id="productofferprice" placeholder=""
            value="{{{productDetails.productofferprice}}}">
        </div>
      </div>

      <div class="form-row mt-2">
        <div class="form-group col-md-6">
          <label for="">Quantity</label>
          <input type="number" class="form-control" name="productquantity" id="productquantity" placeholder=""
            value="{{{productDetails.productquantity}}}">
        </div>
      </div>

      <div class="form-row mt-2">
        <div class="form-group col-md-6  btn">
          <h6>Uploading Date And Time</h6>
          <input type="date" class="form-control" name="productdate" id="productdate" placeholder="" value="{{{date}}}">
        </div>
      </div>

      <div class="form-row mt-4">
        <div class="form-group col-md-6">
          <label for="">Description</label>
          <input type="textarea" class="form-control" name="productdes" id="productdes" placeholder=""
            value="{{productDetails.productdes}}">
        </div>
      </div>

      {{!-- --}}



      {{!-- --}}


      <div class="form-row mt-5">
        <div class="form-group col-md-6">
         
          {{!-- Image 1 --}}
          <div id="errMess1"></div>
          <img src="/uploads/{{productDetails._id}}__1.jpg" alt="" style="width: 100px; height:auto;display: inherit;" id="imgview1">
          <label for="file1" data-toggle="modal" data-target="#editCrop" class="btn btn-primary">IMAGE 1</label>
          <input type="file" name="image1" id="file1" class="form-control" onchange="return fileValidation1()">
          {{!-- Image 1 ends --}}

          {{!-- Image 2 --}}
          <div>
            <div id="errMess2"></div>
            <img src="/uploads/{{productDetails._id}}__2.jpg" alt="" style="width: 100px; height:auto;display: inherit;" id="imgview2">
            <label for="file2" data-toggle="modal" data-target="#editCrop" class="btn btn-primary">IMAGE 2</label>
            <input type="file" name="image2" id="file2" class="form-control" onchange="return fileValidation2()">
          </div>
          {{!-- Image 2 end --}}
          {{!-- Iamge 3 --}}
          <div>
            <div id="errMess3"></div>
            <img src="/uploads/{{productDetails._id}}__3.jpg" alt="" style="width: 100px; height:auto;display: inherit;" id="imgview3">
            <label for="file3" data-toggle="modal" data-target="#editCrop" class="btn btn-primary">IMAGE 3</label>
            <div id="errMess3"></div>
            <input type="file" name="image3" id="file3" class="form-control" onchange="return fileValidation3()">
          </div>

          {{!-- iamge 3 end --}}
        </div>
      </div>
{{!-- Modal for cropping --}}
<div class="modal fade" id="editCrop" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel" data-dismiss="modal">Crop Image</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true"></span>
        </button>
      </div>

      <div class="modal-body">

        <div class="col-12">

          <div style="display: none; " id="image-box"></div>
          <button style="display: none;" class="btn btn-primary mt-4" type="button" data-dismiss="modal" id="crop-btn">Crop</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="buttonDisplay()">Close</button>

        </div>
      </div>
    
    </div>
  </div>
</div>

 {{!-- Modal for cropping Ends--}}

      {{!-- Modal for edit confirmation --}}
      <div class="modal fade bd-example-modal-sm" id="editConfirm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Are you sure ?
            </div>
            <div class="modal-footer">

              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-success" >Edit product</button>

            </div>
          </div>
        </div>
      </div>
      {{!-- Modal for edit confirmation Ends--}}
      <button type="button" data-toggle="modal" data-target="#editConfirm" id="confirm-btn"  class="btn btn-primary">Edit</button>
      <a href="/admin/view-product" class="btn btn-danger">Cancel</a>
    </form>



  </section>
</center>

<script>
function buttonDisplay(){
  document.getElementById('editCrop').style.display = 'none'
}


    function fileValidation1() {
        const imagebox = document.getElementById('image-box')
        const crop_btn = document.getElementById('crop-btn')
        var fileInput = document.getElementById('file1');

        var filePath = fileInput.value;
        var allowedExtensions = /(\.jpg)$/i;
        if (!allowedExtensions.exec(filePath)) {
          document.getElementById('errMess1').innerHTML = '<p style="color:red; display: block;">Invalid file type</p>'
          fileInput.value = '';
          return false;
        } else {
          document.getElementById('errMess1').innerHTML = ''
          //Image preview
          const img_data = fileInput.files[0]
          const url = URL.createObjectURL(img_data)
          imagebox.innerHTML = `<img src="${url}" id="image" style="width:100%">`
          const image = document.getElementById('image')
          document.getElementById('image-box').style.display = 'block'
          document.getElementById('crop-btn').style.display = 'block'
          document.getElementById('confirm-btn').style.display = 'block'

          const cropper = new Cropper(image, {
            autoCropArea: 1,
            viewMode: 1,
            scalable: true,
            zoomable: true,
            movable: true,
            aspectRatio: 0.75 / 1,
              //preview: '.preview',
            minCropBoxWidth: 180,
            minCropBoxHeight: 240,
          })
          crop_btn.addEventListener('click', () => {
            cropper.getCroppedCanvas().toBlob((blob) => {
              let fileInputElement = document.getElementById('file1');
              let file = new File([blob], img_data.name, { type: "image/*", lastModified: new Date().getTime() });
              let container = new DataTransfer();

              container.items.add(file);
              const img = container.files[0]
              var url = URL.createObjectURL(img)
              fileInputElement.files = container.files;
              document.getElementById('imgview1').src = url
              document.getElementById('image-box').style.display = 'none'
              document.getElementById('crop-btn').style.display = 'none'
              document.getElementById('confirm-btn').style.display = 'block'
            });
          });
        }
      }


  function fileValidation2() {
    const imagebox = document.getElementById('image-box')
    const crop_btn = document.getElementById('crop-btn')
    var fileInput = document.getElementById('file2');

    var filePath = fileInput.value;
    var allowedExtensions = /(\.jpg)$/i;
    if (!allowedExtensions.exec(filePath)) {
      document.getElementById('errMess2').innerHTML = '<p style="color:red; display: block;">Invalid file type</p>'
      fileInput.value = '';
      return false;
    } else {
      document.getElementById('errMess2').innerHTML = ''
      //Image preview
      const img_data = fileInput.files[0]
      const url = URL.createObjectURL(img_data)
      imagebox.innerHTML = `<img src="${url}" id="image" style="width:100%">`
      const image = document.getElementById('image')
      document.getElementById('image-box').style.display = 'block'
      document.getElementById('crop-btn').style.display = 'block'
      document.getElementById('confirm-btn').style.display = 'none'

      const cropper = new Cropper(image, {
        autoCropArea: 1,
        viewMode: 1,
        scalable: false,
        zoomable: true,
        movable: true,
        aspectRatio: 0.75 / 1,
        //  preview: '.preview',
        minCropBoxWidth: 180,
        minCropBoxHeight: 240,
      })
      crop_btn.addEventListener('click', () => {
        cropper.getCroppedCanvas().toBlob((blob) => {
          let fileInputElement = document.getElementById('file2');
          let file = new File([blob], img_data.name, { type: "image/*", lastModified: new Date().getTime() });
          let container = new DataTransfer();

          container.items.add(file);
          const img = container.files[0]
          var url = URL.createObjectURL(img)
          fileInputElement.files = container.files;
          document.getElementById('imgview2').src = url
          document.getElementById('image-box').style.display = 'none'
          document.getElementById('crop-btn').style.display = 'none'
          document.getElementById('confirm-btn').style.display = 'block'
        });
      });
    }
  }

  function fileValidation3() {
    const imagebox = document.getElementById('image-box')
    const crop_btn = document.getElementById('crop-btn')
    var fileInput = document.getElementById('file3');

    var filePath = fileInput.value;
    var allowedExtensions = /(\.jpg)$/i;
    if (!allowedExtensions.exec(filePath)) {
      document.getElementById('errMess3').innerHTML = '<p style="color:red; display: block;">Invalid file type</p>'
      fileInput.value = '';
      return false;
    } else {
      document.getElementById('errMess3').innerHTML = ''
      //Image preview
      const img_data = fileInput.files[0]
      const url = URL.createObjectURL(img_data)
      imagebox.innerHTML = `<img src="${url}" id="image" style="width:100%">`
      const image = document.getElementById('image')
      document.getElementById('image-box').style.display = 'block'
      document.getElementById('crop-btn').style.display = 'block'
      document.getElementById('confirm-btn').style.display = 'none'

      const cropper = new Cropper(image, {
        autoCropArea: 1,
        viewMode: 1,
        scalable: false,
        zoomable: true,
        movable: true,
        aspectRatio: 0.75 / 1,
        //  preview: '.preview',
        minCropBoxWidth: 180,
        minCropBoxHeight: 240,
      })
      crop_btn.addEventListener('click', () => {
        cropper.getCroppedCanvas().toBlob((blob) => {
          let fileInputElement = document.getElementById('file3');
          let file = new File([blob], img_data.name, { type: "image/*", lastModified: new Date().getTime() });
          let container = new DataTransfer();

          container.items.add(file);
          const img = container.files[0]
          var url = URL.createObjectURL(img)
          fileInputElement.files = container.files;
          document.getElementById('imgview3').src = url
          document.getElementById('image-box').style.display = 'none'
          document.getElementById('crop-btn').style.display = 'none'
          document.getElementById('confirm-btn').style.display = 'block'
        });
      });
    }
  }


  $(document).ready(function () {
    $("#bikebrand").change(function () {
      var val = $(this).val();
      if (val == "ktm") {
        $("#bikemodel").html("<option value='duke200'>Duke 200</option><option value='duke390'>Duke 390</option><option value='duke250'>Duke 250</option><option value='duke125'>Duke 125</option><option value='rc390'>RC 390</option>");
      } else if (val == "Honda") {
        $("#bikemodel").html("<option value='cbr250'>CBR 250</option><option value='cb300'>CB 300</option><option value='hnesscb350'>H'ness CB 350</option>");
      } else if (val == "Hero") {
        $("#bikemodel").html("<option value='xpulse'>Xpulse</option><option value='impulse'>Impulse</option>");
      } else if (val == "BMW") {
        $("#bikemodel").html("<option value='g310gs'>G 310 GS</option><option value='g310r'>G 310 R</option>");
      } else if (val == "bajaj") {
        $("#bikemodel").html("<option value='dominar400'>Dominar 400</option><option value='rs200'>RS 200</option><option value='ns200'>NS 200</option>");
      } else if (val == "yamaha") {
        $("#bikemodel").html("<option value='r15v3'>R 15V3</option><option value='r3'>R 3</option><option value='mt15'>MT 15</option>");
      } else if (val == "others") {
        $("#bikemodel").html("<option value='jawa'>Jawa</option><option value='ninja300'>Ninja 300</option>");
      }
    });
  });
</script>

{{/if}}